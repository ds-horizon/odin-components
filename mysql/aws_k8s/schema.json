{
  "type": "object",
  "title": "Container provisioning configuration",
  "properties": {
    "image": {
      "type": "object",
      "description": "MySQL Docker image configuration",
      "properties": {
        "registry": {
          "description": "Container registry URL for MySQL Docker images. Specifies where to pull MySQL container images from (e.g., docker.io, gcr.io, ECR). Use private registries for air-gapped environments, compliance requirements, or to avoid rate limits. **Required:** Must be accessible from cluster. **Production:** Use private registry with vulnerability scanning and image signing.",
          "type": "string"
        },
        "repository": {
          "description": "Container image repository path for MySQL. Defines the specific MySQL image to deploy (e.g., bitnami/mysql). Change to use custom images with specific configurations or patches. **Required:** Must exist in specified registry. **Production:** Use verified, security-scanned images from trusted sources.",
          "type": "string"
        },
        "tagSuffix": {
          "description": "MySQL Docker image version tag suffix appended to the base version. For example, if the full docker image tag is '8.0.23' and the base version '8.0' is defined in the base configuration, then this value should be '.23'. The suffix is concatenated with the base version to form the complete image tag. Changing this triggers rolling updates and may require data migrations. **Required:** Must be compatible with existing data. **Production:** Use specific version suffixes (avoid 'latest'), test upgrades in non-prod first.",
          "type": "string"
        }
      },
      "required": ["registry", "repository", "tagSuffix"]
    },
    "storageClass": {
      "description": "Kubernetes storage class for MySQL persistent volumes. Determines storage performance, availability, and backup characteristics (e.g., gp3, io1, ssd). Affects database I/O performance and data durability. Choose based on IOPS requirements and backup policies. **Required:** Must exist in cluster. **Production:** Use high-performance storage (SSD/NVMe) with snapshot capabilities for production workloads.",
      "type": "string"
    },
    "writer": {
      "type": "object",
      "properties": {
        "resources": {
          "type": "object",
          "properties": {
            "limits": {
              "description": "Maximum resource limits for MySQL writer (primary) containers. Hard caps on CPU, memory, and storage to prevent resource exhaustion. Setting too low causes OOM kills or throttling; too high wastes cluster capacity. Configure based on workload sizing and peak usage patterns. **Required:** Must be >= requests. **Production:** Set 20-30% above normal peak usage with monitoring.",
              "type": "object",
              "properties": {
                "cpu": {
                  "description": "Maximum CPU limit for MySQL writer containers. Hard cap on CPU cores (e.g., '2', '1000m'). Prevents CPU exhaustion and ensures fair resource sharing. Exceeding this limit causes throttling. Set based on peak query load and concurrent connections. **Required:** Must be >= requests.cpu. **Production:** Size for peak workload with 20-30% buffer above requests.",
                  "type": "string"
                },
                "memory": {
                  "description": "Maximum memory limit for MySQL writer containers. Hard cap on RAM (e.g., '4Gi', '8192Mi'). Prevents OOM kills and memory exhaustion. Exceeding this limit triggers container termination. Size based on buffer pool, connection overhead, and peak query memory usage. **Required:** Must be >= requests.memory. **Production:** Set 20-30% above requests to handle memory spikes from complex queries.",
                  "type": "string"
                },
                "ephemeralStorage": {
                  "description": "Maximum ephemeral storage limit for MySQL writer containers. Hard cap on temporary disk space (e.g., '20Gi', '50Gi'). Used for temporary tables, sort operations, and query caches. Insufficient storage causes query failures; over-provisioning wastes resources. **Required:** Must be >= requests.ephemeralStorage. **Production:** Size based on largest expected temporary table operations plus 30% buffer.",
                  "type": "string"
                }
              },
              "required": [
                "cpu",
                "memory",
                "ephemeralStorage"
              ]
            },
            "requests": {
              "description": "Guaranteed resource requests for MySQL writer (primary) containers. Reserves minimum CPU, memory, and ephemeral storage for scheduling and QoS. Kubernetes uses this for pod placement and eviction decisions. Under-requesting causes performance issues; over-requesting reduces cluster efficiency. **Required:** Should match baseline workload needs. **Production:** Set based on load testing with 24-hour observation.",
              "type": "object",
              "properties": {
                "cpu": {
                  "description": "Guaranteed CPU request for MySQL writer containers. Minimum CPU cores reserved (e.g., '1', '500m'). Ensures baseline performance and pod scheduling. Used by Kubernetes for placement and eviction decisions. Under-requesting causes throttling; over-requesting reduces cluster capacity. **Required:** Must be <= limits.cpu. **Production:** Set based on average CPU usage during normal operations, typically 60-70% of limits.",
                  "type": "string"
                },
                "memory": {
                  "description": "Guaranteed memory request for MySQL writer containers. Minimum RAM reserved (e.g., '2Gi', '4096Mi'). Ensures baseline memory availability and prevents eviction. Used by Kubernetes scheduler for pod placement. Under-requesting causes OOM risks; over-requesting wastes resources. **Required:** Must be <= limits.memory. **Production:** Set based on buffer pool size plus connection overhead, typically 70-80% of limits.",
                  "type": "string"
                },
                "ephemeralStorage": {
                  "description": "Guaranteed ephemeral storage request for MySQL writer containers. Minimum temporary disk space reserved (e.g., '10Gi', '20Gi'). Ensures availability for temporary tables and sort operations. Used by Kubernetes for scheduling decisions. Under-requesting causes query failures; over-requesting reduces cluster efficiency. **Required:** Must be <= limits.ephemeralStorage. **Production:** Set based on typical temporary table sizes, usually 50-70% of limits.",
                  "type": "string"
                }
              },
              "required": [
                "cpu",
                "memory",
                "ephemeralStorage"
              ]
            }
          },
          "required": [
            "limits",
            "requests"
          ]
        },
        "tolerations": {
          "description": "Pod tolerations for MySQL writer to schedule on tainted nodes. Allows writer pods to run on nodes with specific taints (e.g., dedicated database nodes). Use to isolate database workloads on specialized hardware or availability zones. Empty array schedules on any available node. **Default: `[]`** (no tolerations). **Production:** Use dedicated node pools with taints for database isolation and predictable performance.",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "key": {
                "type": "string"
              },
              "operator": {
                "type": "string",
                "enum": ["Equal", "Exists"]
              },
              "value": {
                "type": "string"
              },
              "effect": {
                "type": "string",
                "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"]
              },
              "tolerationSeconds": {
                "type": "integer"
              }
            },
            "required": ["key", "operator"]
          }
        },
        "nodeSelector": {
          "description": "Node label selectors for MySQL writer pod placement. Constrains writer pods to nodes with matching labels (e.g., disktype=ssd, tier=database). Use to ensure pods run on nodes with appropriate hardware, zones, or compliance requirements. Empty object allows scheduling on any node. **Default: `{}`** (no constraints). **Production:** Use node selectors for dedicated DB nodes with high-performance disks and network.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "persistence": {
          "type": "object",
          "properties": {
            "size": {
              "description": "Persistent volume size for MySQL writer data storage. Determines available space for database files, logs, and temporary tables. Insufficient size causes write failures; over-provisioning increases costs. Size based on data growth projections plus 30-40% buffer. **Required:** Must accommodate current data + growth. **Production:** Monitor usage and plan for 12-18 months growth. PVC expansion depends on storage class support.",
              "type": "string"
            }
          },
          "required": ["size"]
        },
        "serviceAnnotations": {
          "description": "Kubernetes annotations to apply to the MySQL writer service. Adds custom metadata for service discovery, load balancers, or cloud provider integrations (e.g., AWS NLB annotations, service mesh configs). Annotations enable features like internal load balancers, connection draining, or custom DNS entries. **Default: `{}`** (no annotations). **Production:** Use for cloud-specific LB configurations, monitoring integrations, or service mesh sidecar injection policies.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "required": [
        "resources"
      ]
    },
    "reader": {
      "type": "object",
      "properties": {
        "resources": {
          "$ref": "#/properties/writer/properties/resources"
        },
        "tolerations": {
          "$ref": "#/properties/writer/properties/tolerations"
        },
        "nodeSelector": {
          "$ref": "#/properties/writer/properties/nodeSelector"
        },
        "persistence": {
          "$ref": "#/properties/writer/properties/persistence"
        },
        "serviceAnnotations": {
          "$ref": "#/properties/writer/properties/serviceAnnotations"
        },
        "replicaCount": {
          "description": "Number of MySQL reader replicas for read scaling and high availability. Increase for production workloads requiring read scalability or HA. Each replica adds storage and compute costs. **Default: `0`** (standalone setup for dev/testing). **Production:** 2+ replicas recommended for HA across availability zones.",
          "type": "integer",
          "minimum": 0,
          "default": 0
        }
      },
      "required": [
        "resources"
      ]
    },
    "binlog": {
      "description": "MySQL binary logging configuration",
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable MySQL binary logging (binlog) for replication and point-in-time recovery. Required for primary-replica replication and disaster recovery scenarios. Enabling increases disk I/O and storage consumption. Necessary for CDC (Change Data Capture) and audit trails. **Default: `false`** (disabled for standalone). **Production:** Enable for replication setups and production databases requiring PITR capabilities."
        },
        "configuration": {
          "type": "object",
          "description": "Advanced binary log configuration parameters (key-value pairs). Customizes binlog behavior including format (ROW/STATEMENT/MIXED), retention period, file size limits. Use for fine-tuning replication performance and storage management. Misconfiguration can cause replication lag or excessive disk usage. **Optional:** Only needed for specific binlog requirements. **Production:** Configure `binlog_expire_logs_seconds` for retention and `max_binlog_size` for file management.",
          "additionalProperties": true
        }
      },
      "required": ["enabled"]
    },
    "metrics": {
      "description": "MySQL metrics exporter configuration",
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable MySQL metrics exporter for Prometheus monitoring and observability. Provides database performance metrics, connection stats, and query metrics for monitoring dashboards and alerting. Disabling reduces resource usage but eliminates metrics visibility. **Default: `true`** (recommended for production). **Production:** Keep enabled for monitoring and alerting capabilities."
        },
        "image": {
          "type": "object",
          "properties": {
            "registry": {
              "type": "string",
              "default": "docker.io",
              "description": "Container image registry URL for the MySQL metrics exporter. Specifies where to pull the exporter image from (e.g., docker.io, gcr.io, or private registries). Use private registries for air-gapped environments or compliance requirements. **Default: `docker.io`** (public Docker Hub). **Production:** Use private registry for security and compliance."
            },
            "repository": {
              "type": "string",
              "default": "bitnamilegacy/mysqld-exporter",
              "description": "Container image repository path for the MySQL metrics exporter. Defines the specific exporter image to use for collecting MySQL metrics. Change only if using a custom or alternative exporter image. **Default: `bitnamilegacy/mysqld-exporter`** (Bitnami's MySQL exporter). **Production:** Verify image compatibility and security scanning for custom repositories."
            }
          },
          "required": ["registry", "repository"]
        }
      },
      "required": ["enabled"]
    }
  },
  "required": [
    "image",
    "storageClass",
    "writer",
    "reader"
  ],
  "additionalProperties": false
}
